{% extends "base.html" %}
{% block title %}{{ tr.nav_dashboard|default('Dashboard' if locale == 'en' else 'Дашборд') }} — MyVOICE's{% endblock %}
{% block content %}
{% set is_en = locale == 'en' %}
{% set news_count = (news_items|length) if news_items else 0 %}
{% set reddit_count = (reddit_items|length) if reddit_items else 0 %}
{% set drafts_count = (comment_drafts_total|int) if comment_drafts_total is not none else 0 %}
{% set todo_count = (comment_todo_total|int) if comment_todo_total is not none else 0 %}
<section class="dash-header">
  <h1>{{ tr.nav_dashboard|default('Dashboard' if is_en else 'Дашборд') }}</h1>
  <p>
    {{ 'Key queues and top-ranked items for the last 24 hours.' if is_en else 'Ключевые очереди и топ-материалы за последние 24 часа.' }}
  </p>
</section>

<section class="dash-focus" aria-label="{{ 'Today focus' if is_en else 'Фокус на сегодня' }}">
  <div class="dash-focus-left">
    <div class="dash-focus-title">{{ 'Today focus' if is_en else 'Фокус на сегодня' }}</div>
    <div class="dash-metrics" role="list">
      <a class="dash-metric" role="listitem" href="#dash-priority">
        <div class="dash-metric-top">
          <span class="dash-metric-label">{{ 'New to generate' if is_en else 'Новые к генерации' }}</span>
          <span class="dash-chip dash-chip--count {{ 'is-zero' if todo_count == 0 else ('is-20' if todo_count >= 20 else ('is-10' if todo_count >= 10 else 'is-1')) }}">{{ todo_count }}</span>
        </div>
        <div class="dash-metric-sub">{{ 'Highest priority queue.' if is_en else 'Самый приоритетный блок.' }}</div>
      </a>
      <a class="dash-metric" role="listitem" href="#dash-drafts">
        <div class="dash-metric-top">
          <span class="dash-metric-label">{{ 'Drafts' if is_en else 'Черновики' }}</span>
          <span class="dash-chip dash-chip--count {{ 'is-zero' if drafts_count == 0 else ('is-20' if drafts_count >= 20 else ('is-10' if drafts_count >= 10 else 'is-1')) }}">{{ drafts_count }}</span>
        </div>
        <div class="dash-metric-sub">{{ 'Generated, not sent.' if is_en else 'Сгенерированы, не отправлены.' }}</div>
      </a>
      <a class="dash-metric" role="listitem" href="#dash-news">
        <div class="dash-metric-top">
          <span class="dash-metric-label">{{ 'Top news 24h' if is_en else 'Топ новости 24ч' }}</span>
          <span class="dash-chip dash-chip--count {{ 'is-zero' if news_count == 0 else ('is-20' if news_count >= 20 else ('is-10' if news_count >= 10 else 'is-1')) }}">{{ news_count }}</span>
        </div>
        <div class="dash-metric-sub">{{ 'Max 3 items.' if is_en else 'Максимум 3.' }}</div>
      </a>
      <a class="dash-metric" role="listitem" href="#dash-reddit">
        <div class="dash-metric-top">
          <span class="dash-metric-label">{{ 'Top reddit 24h' if is_en else 'Топ Reddit 24ч' }}</span>
          <span class="dash-chip dash-chip--count {{ 'is-zero' if reddit_count == 0 else ('is-20' if reddit_count >= 20 else ('is-10' if reddit_count >= 10 else 'is-1')) }}">{{ reddit_count }}</span>
        </div>
        <div class="dash-metric-sub">{{ 'Max 3 items.' if is_en else 'Максимум 3.' }}</div>
      </a>
    </div>
  </div>

  <div class="dash-focus-right">
    <div class="dash-updated">
      <span class="dash-updated-dot" aria-hidden="true"></span>
      <span id="dash-updated-text">{{ 'Updated just now.' if is_en else 'Обновлено только что.' }}</span>
    </div>
    <a class="dash-primary-btn" href="/ui/posts">{{ 'Go to priorities' if is_en else 'Перейти к приоритетным' }}</a>
  </div>
</section>

<div class="dash-grid">
  <section class="dash-card dash-card--priority" id="dash-priority" aria-labelledby="dash-priority-title">
    <div class="dash-card-head">
      <div class="dash-card-head-left">
        <h2 id="dash-priority-title">{{ 'New Comments To Generate' if is_en else 'Новые комментарии к генерации' }}</h2>
        <div class="dash-card-subtitle">{{ 'Start here. Posts without generated variants.' if is_en else 'Начинай отсюда. Посты без сгенерированных вариантов.' }}</div>
      </div>
      <span class="dash-chip dash-chip--count {{ 'is-zero' if todo_count == 0 else ('is-20' if todo_count >= 20 else ('is-10' if todo_count >= 10 else 'is-1')) }}">{{ todo_count }}</span>
    </div>
    <ul class="dash-skeleton" aria-hidden="true">
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 78%;"></div>
        <div class="skeleton-line" style="width: 96%;"></div>
        <div class="skeleton-line" style="width: 62%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 88%;"></div>
        <div class="skeleton-line" style="width: 92%;"></div>
        <div class="skeleton-line" style="width: 54%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 70%;"></div>
        <div class="skeleton-line" style="width: 98%;"></div>
        <div class="skeleton-line" style="width: 58%;"></div>
      </li>
    </ul>
    {% if comment_todo %}
      <ul class="dash-list">
        {% for item in comment_todo %}
          <li>
            <a class="dash-item-link" href="{{ '/ui/posts?compose_post_id=' ~ item.id ~ '&compose_mode=generate' if item.id else '/ui/posts' }}"
               data-tooltip-title="{{ item.title|e }}"
               data-tooltip-body="{{ (item.person_name ~ ' · ' ~ item.posted_label)|e }}">
              <div class="dash-item-title">{{ item.title }}</div>
              <div class="dash-meta" aria-label="{{ 'Meta' if is_en else 'Метаданные' }}">
                <span>{{ item.person_name }}</span>
                <span>{{ item.posted_label }}</span>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="dash-empty-state">
        <p class="dash-empty">{{ 'New posts will appear here when they need comments.' if is_en else 'Здесь появятся посты, которым нужно сгенерировать комментарии.' }}</p>
        <a class="dash-mini-cta" href="/ui/posts">{{ 'Open comments' if is_en else 'Открыть комментарии' }}</a>
      </div>
    {% endif %}
    {% if comment_todo %}
      <a class="dash-section-cta" href="/ui/posts">{{ 'Open Comments' if is_en else 'Открыть Комментарии' }}</a>
    {% endif %}
  </section>

  <section class="dash-card dash-card--news" id="dash-news" aria-labelledby="dash-news-title">
    <div class="dash-card-head">
      <div class="dash-card-head-left">
        <h2 id="dash-news-title">{{ 'Top News' if is_en else 'Топ новости' }}</h2>
        <div class="dash-card-subtitle">{{ 'Top-ranked items for 24 hours.' if is_en else 'Топ материалы за 24 часа.' }}</div>
      </div>
      <span class="dash-chip dash-chip--time">24h</span>
    </div>
    <ul class="dash-skeleton" aria-hidden="true">
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 76%;"></div>
        <div class="skeleton-line" style="width: 94%;"></div>
        <div class="skeleton-line" style="width: 52%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 84%;"></div>
        <div class="skeleton-line" style="width: 90%;"></div>
        <div class="skeleton-line" style="width: 48%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 72%;"></div>
        <div class="skeleton-line" style="width: 96%;"></div>
        <div class="skeleton-line" style="width: 56%;"></div>
      </li>
    </ul>
    {% if news_items %}
      <ul class="dash-list">
        {% for item in news_items %}
          <li>
            <a class="dash-item-link" href="{{ '/ui/news?compose_news_id=' ~ item.id if item.id else '/ui/news' }}"
               data-tooltip-title="{{ item.title|e }}"
               data-tooltip-body="{{ (item.summary or ('No preview text.' if is_en else 'Нет превью текста.'))|e }}">
              <div class="dash-item-title">{{ item.title }}</div>
              <div class="dash-item-preview">{% if item.summary %}{{ item.summary }}{% else %}{{ 'No preview text.' if is_en else 'Нет превью текста.' }}{% endif %}</div>
              <div class="dash-meta" aria-label="{{ 'Meta' if is_en else 'Метаданные' }}">
                <span>{{ item.source or ('Unknown source' if is_en else 'Источник не указан') }}</span>
                <span>{{ 'Score' if is_en else 'Скор' }} {{ item.score if item.score is not none else '-' }}</span>
                <span>{{ item.published_label }}</span>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="dash-empty-state">
        <p class="dash-empty">{{ 'Top news for the last 24h will show up here.' if is_en else 'Здесь появятся топ новости за последние 24 часа.' }}</p>
        <a class="dash-mini-cta" href="/ui/dashboard">{{ 'Refresh' if is_en else 'Обновить' }}</a>
      </div>
    {% endif %}
    {% if news_items %}
      <a class="dash-section-cta" href="/ui/news">{{ 'Open News' if is_en else 'Открыть Новости' }}</a>
    {% endif %}
  </section>

  <section class="dash-card dash-card--reddit" id="dash-reddit" aria-labelledby="dash-reddit-title">
    <div class="dash-card-head">
      <div class="dash-card-head-left">
        <h2 id="dash-reddit-title">{{ 'Top Reddit' if is_en else 'Топ Reddit' }}</h2>
        <div class="dash-card-subtitle">{{ 'Top-ranked posts for 24 hours.' if is_en else 'Топ посты за 24 часа.' }}</div>
      </div>
      <span class="dash-chip dash-chip--time">24h</span>
    </div>
    <ul class="dash-skeleton" aria-hidden="true">
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 82%;"></div>
        <div class="skeleton-line" style="width: 46%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 74%;"></div>
        <div class="skeleton-line" style="width: 52%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 86%;"></div>
        <div class="skeleton-line" style="width: 44%;"></div>
      </li>
    </ul>
    {% if reddit_items %}
      <ul class="dash-list">
        {% for item in reddit_items %}
          <li>
            <a class="dash-item-link" href="{{ '/ui/reddit?compose_reddit_id=' ~ item.id if item.id else '/ui/reddit' }}"
               data-tooltip-title="{{ item.title|e }}"
               data-tooltip-body="{{ (item.content or '')|e }}">
              <div class="dash-item-title">{{ item.title }}</div>
              {% if item.content %}
                <div class="dash-item-preview">{{ item.content }}</div>
              {% endif %}
              <div class="dash-meta" aria-label="{{ 'Meta' if is_en else 'Метаданные' }}">
                <span>r/{{ item.subreddit }}</span>
                <span>{{ 'Score' if is_en else 'Скор' }} {{ item.score if item.score is not none else '-' }}</span>
                <span>{{ item.posted_label }}</span>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="dash-empty-state">
        <p class="dash-empty">{{ 'Top reddit posts for the last 24h will show up here.' if is_en else 'Здесь появятся топ посты Reddit за последние 24 часа.' }}</p>
        <a class="dash-mini-cta" href="/ui/dashboard">{{ 'Refresh' if is_en else 'Обновить' }}</a>
      </div>
    {% endif %}
    {% if reddit_items %}
      <a class="dash-section-cta" href="/ui/reddit">{{ 'Open Reddit' if is_en else 'Открыть Reddit' }}</a>
    {% endif %}
  </section>

  <section class="dash-card dash-card--drafts" id="dash-drafts" aria-labelledby="dash-drafts-title">
    <div class="dash-card-head">
      <div class="dash-card-head-left">
        <h2 id="dash-drafts-title">{{ 'Draft Comments' if is_en else 'Черновики комментариев' }}</h2>
        <div class="dash-card-subtitle">{{ 'Generated, but not sent yet.' if is_en else 'Сгенерированы, но еще не отправлены.' }}</div>
      </div>
      <span class="dash-chip dash-chip--count {{ 'is-zero' if drafts_count == 0 else ('is-20' if drafts_count >= 20 else ('is-10' if drafts_count >= 10 else 'is-1')) }}">{{ drafts_count }}</span>
    </div>
    <ul class="dash-skeleton" aria-hidden="true">
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 80%;"></div>
        <div class="skeleton-line" style="width: 48%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 76%;"></div>
        <div class="skeleton-line" style="width: 54%;"></div>
      </li>
      <li class="dash-skeleton-item">
        <div class="skeleton-line" style="width: 88%;"></div>
        <div class="skeleton-line" style="width: 46%;"></div>
      </li>
    </ul>
    {% if comment_drafts %}
      <ul class="dash-list">
        {% for item in comment_drafts %}
          <li>
            <a class="dash-item-link" href="{{ '/ui/posts?compose_post_id=' ~ item.id ~ '&compose_mode=draft' if item.id else '/ui/posts' }}"
               data-tooltip-title="{{ item.title|e }}"
               data-tooltip-body="{{ (item.person_name ~ ' · ' ~ item.posted_label)|e }}">
              <div class="dash-item-title">{{ item.title }}</div>
              <div class="dash-meta" aria-label="{{ 'Meta' if is_en else 'Метаданные' }}">
                <span>{{ item.person_name }}</span>
                <span>{{ item.posted_label }}</span>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="dash-empty-state">
        <p class="dash-empty">{{ 'Generated drafts will appear here before you send them.' if is_en else 'Здесь появятся сгенерированные черновики перед отправкой.' }}</p>
        <a class="dash-mini-cta" href="/ui/posts">{{ 'Open comments' if is_en else 'Открыть комментарии' }}</a>
      </div>
    {% endif %}
    {% if comment_drafts %}
      <a class="dash-section-cta" href="/ui/posts">{{ 'Open Comments' if is_en else 'Открыть Комментарии' }}</a>
    {% endif %}
  </section>
</div>

<div id="dash-tooltip" class="dash-tooltip" role="tooltip" hidden>
  <div class="dash-tooltip-title" id="dash-tooltip-title"></div>
  <div class="dash-tooltip-body" id="dash-tooltip-body"></div>
</div>

<script>
  (function() {
    var updatedEl = document.getElementById('dash-updated-text');
    if (!updatedEl) return;

    var isEn = {{ 'true' if is_en else 'false' }};
    var loadedAt = Date.now();
    var REFRESH_MS = 60 * 60 * 1000;

    function setText(minutes) {
      if (minutes <= 0) {
        updatedEl.textContent = isEn ? 'Updated just now.' : 'Обновлено только что.';
        return;
      }
      updatedEl.textContent = isEn ? ('Updated ' + minutes + ' min ago.') : ('Обновлено ' + minutes + ' мин назад.');
    }

    function tick() {
      var mins = Math.floor((Date.now() - loadedAt) / 60000);
      setText(mins);
    }

    tick();
    window.setInterval(tick, 60000);
    window.setTimeout(function() { window.location.reload(); }, REFRESH_MS);
  })();

  (function() {
    var tooltip = document.getElementById('dash-tooltip');
    var ttTitle = document.getElementById('dash-tooltip-title');
    var ttBody = document.getElementById('dash-tooltip-body');
    if (!tooltip || !ttTitle || !ttBody) return;
    if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) return;

    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }
    function hide() { tooltip.hidden = true; }

    function showFor(el) {
      var title = el.getAttribute('data-tooltip-title') || '';
      var body = el.getAttribute('data-tooltip-body') || '';
      if (!title && !body) return hide();
      ttTitle.textContent = title;
      ttBody.textContent = body;
      tooltip.hidden = false;

      // Position near the card without layout shifts.
      var rect = el.getBoundingClientRect();
      tooltip.style.maxWidth = Math.min(420, Math.floor(window.innerWidth * 0.45)) + 'px';

      // First place on the right.
      tooltip.style.left = '0px';
      tooltip.style.top = '0px';
      tooltip.style.transform = 'translate3d(0,0,0)';
      var ttRect = tooltip.getBoundingClientRect();

      var gap = 12;
      var left = rect.right + gap;
      var top = rect.top + Math.min(16, Math.max(8, (rect.height - ttRect.height) / 2));

      // If overflows right, place to the left.
      if (left + ttRect.width > window.innerWidth - 12) {
        left = rect.left - gap - ttRect.width;
      }
      // Clamp within viewport.
      left = clamp(left, 12, window.innerWidth - ttRect.width - 12);
      top = clamp(top, 12, window.innerHeight - ttRect.height - 12);

      tooltip.style.transform = 'translate3d(' + Math.round(left) + 'px,' + Math.round(top) + 'px,0)';
    }

    document.addEventListener('mouseenter', function(e) {
      var el = e.target && e.target.closest ? e.target.closest('.dash-item-link') : null;
      if (!el) return;
      showFor(el);
    }, true);

    document.addEventListener('mouseleave', function(e) {
      var el = e.target && e.target.closest ? e.target.closest('.dash-item-link') : null;
      if (!el) return;
      hide();
    }, true);

    window.addEventListener('scroll', hide, { passive: true });
    window.addEventListener('resize', hide);
  })();
</script>

<style>
  .dash-header { margin: 0; }
  .dash-header h1 {
    margin: 0 0 8px;
    font-size: 28px;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: #111827;
    line-height: 32px;
  }
  .dash-header p {
    margin: 0 0 16px;
    font-size: 14px;
    color: #4b5563;
    line-height: 20px;
    max-width: 760px;
  }

  .dash-focus {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px 16px 16px 16px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 40px;
  }
  .dash-focus-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    line-height: 1.2;
    margin-bottom: 12px;
  }
  .dash-focus-left { min-width: 0; flex: 1 1 auto; }
  .dash-focus-right {
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 12px;
    padding-top: 4px;
  }
  .dash-updated {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--text-muted);
    white-space: nowrap;
  }
  .dash-updated-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(99,102,241,0.35);
    box-shadow: 0 0 0 3px rgba(99,102,241,0.10);
  }
  .dash-primary-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 40px;
    padding: 0 14px;
    border-radius: 999px;
    background: #6366f1;
    color: #ffffff;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 8px 18px rgba(79, 70, 229, 0.18);
    transition: transform 180ms ease-out, box-shadow 180ms ease-out, background 180ms ease-out;
    white-space: nowrap;
  }
  .dash-primary-btn:hover {
    background: #4f46e5;
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(79, 70, 229, 0.22);
    text-decoration: none;
    color: #ffffff;
  }

  .dash-metrics {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
  }
  .dash-metric {
    display: block;
    border: 1px solid #eef2ff;
    background: #fbfcff;
    border-radius: 12px;
    padding: 12px;
    text-decoration: none;
    transition: background 180ms ease-out, border-color 180ms ease-out, transform 180ms ease-out;
    min-width: 0;
  }
  .dash-metric:hover {
    background: #f4f6ff;
    border-color: rgba(99,102,241,0.25);
    transform: translateY(-1px);
    text-decoration: none;
  }
  .dash-metric-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    min-width: 0;
  }
  .dash-metric-label {
    font-size: 13px;
    font-weight: 600;
    color: #111827;
    line-height: 1.2;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .dash-metric-sub {
    margin-top: 8px;
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.4;
  }

  .dash-grid {
    display: grid;
    grid-template-columns: 1.18fr 1fr;
    grid-template-areas:
      "priority news"
      "priority reddit"
      "drafts drafts";
    column-gap: 32px;
    row-gap: 40px;
  }

  .dash-card {
    background: #ffffff;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    display: flex;
    flex-direction: column;
    min-height: 280px;
    opacity: 0;
    transform: translateY(8px);
    animation: dash-card-in 240ms ease-out forwards;
    transition: transform 200ms ease-out, box-shadow 200ms ease-out;
    will-change: transform, box-shadow;
    scroll-margin-top: 24px;
  }
  .dash-card:hover {
    box-shadow: 0 8px 24px rgba(0,0,0,0.06);
    transform: translateY(-2px);
  }

  .dash-card--priority { grid-area: priority; border-color: rgba(99,102,241,0.28); box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
  .dash-card--priority:hover { box-shadow: 0 12px 30px rgba(0,0,0,0.08); }
  .dash-card--news { grid-area: news; }
  .dash-card--reddit { grid-area: reddit; }
  .dash-card--drafts { grid-area: drafts; }

  .dash-card-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 16px;
  }
  .dash-card-head-left { display: grid; gap: 6px; min-width: 0; }
  .dash-card h2 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
    color: #111827;
    line-height: 1.2;
    min-width: 0;
  }
  .dash-card-subtitle {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.4;
  }

  .dash-chip {
    background: rgba(99,102,241,0.12);
    color: #4f46e5;
    font-size: 12px;
    font-weight: 600;
    padding: 6px 10px;
    border-radius: 999px;
    line-height: 1;
    white-space: nowrap;
  }
  .dash-chip--time {
    background: rgba(99,102,241,0.12);
    color: #4f46e5;
  }
  .dash-chip--count { text-align: center; min-width: 34px; }
  .dash-chip--count.is-zero { background: rgba(15,23,42,0.06); color: #64748b; }
  .dash-chip--count.is-1 { background: rgba(99,102,241,0.10); color: #4f46e5; }
  .dash-chip--count.is-10 { background: rgba(99,102,241,0.16); color: #4338ca; }
  .dash-chip--count.is-20 { background: rgba(99,102,241,0.22); color: #3730a3; }

  .dash-note {
    margin: 0 0 16px;
    color: var(--text-muted);
    font-size: 13px;
    line-height: 1.5;
  }

  .dash-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .dash-item-link {
    display: block;
    padding: 16px;
    border-radius: 12px;
    border: 1px solid #f1f3f7;
    background: var(--dash-item-bg, #fafbff);
    text-decoration: none;
    cursor: pointer;
    transition: background 180ms ease, border-color 180ms ease;
    min-width: 0;
  }
  .dash-item-link:hover,
  .dash-item-link:focus-visible {
    --dash-item-bg: #f4f6ff;
    background: var(--dash-item-bg, #f4f6ff);
    border-color: rgba(99,102,241,0.25);
    text-decoration: none;
  }
  .dash-item-link:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.18);
  }

  .dash-item-title {
    color: #0f172a;
    font-weight: 600;
    font-size: 15px;
    line-height: 1.4;
    margin: 0 0 6px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .dash-item-preview {
    position: relative;
    margin: 0 0 10px;
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .dash-item-preview::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 18px;
    background: linear-gradient(180deg, rgba(255,255,255,0), var(--dash-item-bg, #fafbff));
    pointer-events: none;
  }

  .dash-meta {
    display: flex;
    flex-wrap: wrap;
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.4;
    gap: 12px;
    overflow: hidden;
    white-space: nowrap;
  }
  .dash-meta span { overflow: hidden; text-overflow: ellipsis; }

  .dash-empty {
    margin: 0;
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.5;
  }

  .dash-empty-state {
    margin-top: 8px;
    padding: 14px;
    border-radius: 12px;
    border: 1px dashed rgba(15,23,42,0.14);
    background: rgba(248,249,252,0.55);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }
  .dash-mini-cta {
    flex: 0 0 auto;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 32px;
    padding: 0 10px;
    border-radius: 999px;
    border: 1px solid rgba(99,102,241,0.28);
    background: rgba(99,102,241,0.08);
    color: #4f46e5;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    transition: background 180ms ease-out, border-color 180ms ease-out;
    white-space: nowrap;
  }
  .dash-mini-cta:hover {
    background: rgba(99,102,241,0.12);
    border-color: rgba(99,102,241,0.36);
    text-decoration: none;
  }

  .dash-section-cta {
    margin-top: auto;
    align-self: flex-start;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    height: 32px;
    padding: 0 10px;
    border-radius: 999px;
    border: 1px solid rgba(15,23,42,0.10);
    background: rgba(248,249,252,0.9);
    color: #4f46e5;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    transition: background 180ms ease-out, border-color 180ms ease-out, transform 180ms ease-out;
  }
  .dash-section-cta:hover {
    background: rgba(99,102,241,0.08);
    border-color: rgba(99,102,241,0.18);
    transform: translateY(-1px);
    text-decoration: none;
    color: #4f46e5;
  }

  .dash-skeleton { display: none; margin: 0; padding: 0; list-style: none; }
  .dash-card[data-loading="1"] .dash-skeleton { display: grid; gap: 12px; }
  .dash-card[data-loading="1"] .dash-list,
  .dash-card[data-loading="1"] .dash-empty,
  .dash-card[data-loading="1"] .dash-note { display: none; }
  .dash-skeleton-item {
    padding: 16px;
    border-radius: 12px;
    border: 1px solid #f1f3f7;
    background: #fafbff;
  }
  .dash-skeleton-item .skeleton-line { height: 14px; }
  .dash-skeleton-item .skeleton-line + .skeleton-line { margin-top: 8px; }

  .dash-tooltip {
    position: fixed;
    z-index: 9999;
    padding: 12px;
    border-radius: 12px;
    background: rgba(15,23,42,0.94);
    color: #ffffff;
    box-shadow: 0 20px 50px rgba(0,0,0,0.25);
    max-width: 420px;
    pointer-events: none;
  }
  .dash-tooltip-title {
    font-size: 13px;
    font-weight: 700;
    line-height: 1.35;
    margin: 0 0 6px 0;
  }
  .dash-tooltip-body {
    font-size: 13px;
    line-height: 1.5;
    color: rgba(255,255,255,0.82);
    white-space: pre-wrap;
    max-height: 180px;
    overflow: hidden;
  }

  @keyframes dash-card-in {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (prefers-reduced-motion: reduce) {
    .dash-card { animation: none; opacity: 1; transform: none; }
    .dash-card:hover { transform: none; }
    .dash-metric:hover { transform: none; }
    .dash-primary-btn:hover { transform: none; }
  }

  @media (max-width: 1050px) {
    .dash-focus { flex-direction: column; align-items: stretch; }
    .dash-focus-right { align-items: flex-start; }
    .dash-metrics { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .dash-grid {
      grid-template-columns: 1fr;
      grid-template-areas:
        "priority"
        "news"
        "reddit"
        "drafts";
    }
    .dash-header h1 { font-size: 24px; line-height: 30px; }
  }
</style>
{% endblock %}
